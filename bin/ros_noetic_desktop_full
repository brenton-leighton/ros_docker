#!/usr/bin/env bash

SCRIPT_DIR=$(dirname $(realpath "$0"))

export COMPOSE_PROJECT_NAME=ros-noetic-desktop-full
PROJECT_PATH=${SCRIPT_DIR}/../noetic/${COMPOSE_PROJECT_NAME}/

# Get the -b option to build
while getopts b NAME
do
   case $NAME in
   b) BUILD="--build";;
   esac
done
shift $(($OPTIND - 1))

# Home directory on the host
export HOST_HOME_PATH=${PROJECT_PATH}/home
mkdir -p ${HOST_HOME_PATH}/catkin_ws

# Other variables
export USER_ID=$(id -u)
export COMPOSE_BAKE=true

# Additional things for GUI
mkdir -p /tmp/.X11-unix
touch ${HOME}/.Xauthority
export XDG_RUNTIME_DIR="/tmp/$(id -u)"

# docker compose run
docker compose --file ${PROJECT_PATH}/compose.yaml run ${BUILD} --rm default ${@}
