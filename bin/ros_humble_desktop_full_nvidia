#!/usr/bin/env bash

SCRIPT_DIR=$(dirname $(realpath "$0"))

export COMPOSE_PROJECT_NAME=ros-humble-desktop-full-nvidia
PROJECT_PATH=${SCRIPT_DIR}/../humble/${COMPOSE_PROJECT_NAME}/

# Parse options to set $BUILD
source ${SCRIPT_DIR}/_get_build_option

# Home directory on the host
export HOST_HOME_PATH=${PROJECT_PATH}/home
mkdir -p ${HOST_HOME_PATH}/ros2_ws

# Other variables
export USER_ID=$(id -u)
export COMPOSE_BAKE=true

# Additional things for GUI
mkdir -p /tmp/.X11-unix
touch ${HOME}/.Xauthority
export XDG_RUNTIME_DIR="/tmp/$(id -u)"

# docker compose run
docker compose --file ${PROJECT_PATH}/compose.yaml run ${BUILD} --rm default ${@}
