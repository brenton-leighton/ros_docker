#!/usr/bin/env bash

SCRIPT_PATH=$(realpath "${0}")
SCRIPT_DIR=$(dirname "${SCRIPT_PATH}")

PROJECT_DIR="${SCRIPT_DIR}/../humble/ros-humble-desktop-full-nvidia"

# Parse options to set $BUILD
source "${SCRIPT_DIR}/_get_build_opt"

# Home directory on the host
export HOST_HOME_DIR="${PROJECT_DIR}/home"
mkdir -p "${HOST_HOME_DIR}/ros2_ws/src"

# Other variables
export USER_ID=$(id -u)

# Additional things for GUI
"${SCRIPT_DIR}/_check_gui_vars"
if [ ${?} -ne 0 ]; then
  exit
fi

# docker compose run
docker compose --file "${PROJECT_DIR}/compose.yaml" run ${BUILD} --rm default ${@}
