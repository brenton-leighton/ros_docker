#!/usr/bin/env bash

SCRIPT_DIR=$(dirname $(realpath "$0"))

export COMPOSE_PROJECT_NAME=ros-noetic-perception-tensorrt
PROJECT_PATH=${SCRIPT_DIR}/../noetic/${COMPOSE_PROJECT_NAME}/

# Get the -b option to build
while getopts b NAME
do
   case $NAME in
   b) BUILD="--build";;
   esac
done
shift $(($OPTIND - 1))

# Home directory on the host
export HOST_HOME_PATH=${PROJECT_PATH}/home
mkdir -p ${HOST_HOME_PATH}/catkin_ws

# Other variables
export USER_ID=$(id -u)
export COMPOSE_BAKE=true

# docker compose run
docker compose --file ${PROJECT_PATH}/compose.yaml run ${BUILD} --rm default ${@}
